<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KeyByDPMods</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { --bg: #0d0d0d; --header: #121212; --card: #151b24; --border: #242c38; --accent: #00ff9d; --text-main: #ffffff; --text-muted: #8b949e; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; user-select: none; }
        body { background-color: var(--bg); color: var(--text-main); min-height: 100vh; display: flex; flex-direction: column; padding-bottom: 80px; }
        
        /* HEADER */
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 20px; background: var(--header); border-bottom: 1px solid rgba(255,255,255,0.05); position: sticky; top: 0; z-index: 50; }
        .brand { font-weight: 700; font-size: 1.1rem; letter-spacing: -0.5px; }
        .head-icons { display: flex; gap: 15px; color: var(--text-muted); font-size: 1rem; }
        
        /* CONTENT */
        .container { padding: 25px 20px; width: 100%; max-width: 500px; margin: 0 auto; flex: 1; }
        .breadcrumb { font-size: 0.8rem; color: var(--text-muted); margin-bottom: 10px; display: flex; align-items: center; gap: 6px; }
        h1 { font-size: 1.8rem; font-weight: 600; margin-bottom: 25px; letter-spacing: -0.5px; }
        
        /* CARD */
        .gen-card { background: var(--card); border: 1px solid var(--border); border-radius: 16px; padding: 30px 20px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative; overflow: hidden; background: linear-gradient(180deg, rgba(13,20,34,1) 0%, rgba(21,27,36,1) 100%); }
        .gen-card::before { content:''; position: absolute; top:0; left:0; width:100%; height:3px; background: linear-gradient(90deg, transparent, var(--accent), transparent); box-shadow: 0 0 15px var(--accent); }
        
        .lbl-status { color: var(--text-muted); font-size: 0.8rem; margin-top: 5px; margin-bottom: 20px; }
        .lbl-title { color: var(--accent); font-weight: 700; font-size: 1.1rem; letter-spacing: 0.5px; }
        
        /* KEY BOX & BTN */
        .key-box { border: 1px dashed rgba(0, 255, 157, 0.3); background: rgba(0, 255, 157, 0.03); border-radius: 12px; padding: 20px; margin-bottom: 25px; cursor: pointer; transition: 0.2s; position: relative; }
        .key-box:active { background: rgba(0, 255, 157, 0.08); transform: scale(0.98); }
        .key-text { font-family: 'JetBrains Mono', monospace; font-size: 1.6rem; font-weight: 700; color: #fff; letter-spacing: 1px; text-shadow: 0 0 10px rgba(0, 255, 157, 0.2); }
        
        .btn-action { background: var(--accent); color: #000; border: none; padding: 14px 40px; border-radius: 50px; font-weight: 700; font-size: 0.95rem; cursor: pointer; box-shadow: 0 4px 15px rgba(0, 255, 157, 0.3); transition: 0.2s; width: 100%; max-width: 250px; margin-bottom: 25px; }
        .btn-action:active {transform: scale(0.95); opacity: 0.9;}

        /* SOCIAL & CONTACT */
        .social-group { display: flex; justify-content: center; gap: 15px; margin-bottom: 15px; border-top: 1px solid var(--border); padding-top: 20px; }
        .soc-icon { width: 45px; height: 45px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.3rem; color: #fff; background: rgba(255,255,255,0.05); border: 1px solid var(--border); transition: 0.3s; text-decoration: none; cursor: pointer; }
        .soc-icon:hover { transform: translateY(-3px); }
        .yt:hover { background: #ff0000; border-color: #ff0000; box-shadow: 0 5px 15px rgba(255,0,0,0.3); }
        .tg:hover { background: #0088cc; border-color: #0088cc; box-shadow: 0 5px 15px rgba(0,136,204,0.3); }
        .wa:hover { background: #25d366; border-color: #25d366; box-shadow: 0 5px 15px rgba(37,211,102,0.3); }

        .admin-btn { display: flex; align-items: center; justify-content: center; gap: 10px; width: 100%; text-decoration: none; color: var(--text-muted); font-size: 0.85rem; padding: 12px; border: 1px solid var(--border); border-radius: 14px; transition: 0.2s; font-weight: 600; background: rgba(255,255,255,0.02); }
        .admin-btn:hover { border-color: var(--accent); color: var(--accent); background: rgba(0, 229, 255, 0.05); }

        /* FOOTER & NAV */
        .nav-bar { position: fixed; bottom: 0; left: 0; width: 100%; background: rgba(18, 18, 18, 0.95); backdrop-filter: blur(10px); border-top: 1px solid var(--border); display: flex; justify-content: space-around; padding: 12px 0; z-index: 99; }
        .nav-btn { display: flex; flex-direction: column; align-items: center; color: var(--text-muted); font-size: 0.65rem; gap: 5px; cursor: pointer; transition: 0.2s; }
        .nav-btn i { font-size: 1.2rem; margin-bottom: 2px; }
        .nav-btn.active { color: #fff; }
        .footer { margin-top: auto; border-top: 1px solid var(--border); padding-top: 20px; display: flex; justify-content: space-between; color: var(--text-muted); font-size: 0.8rem; }
        
        .loader { width: 25px; height: 25px; border: 3px solid rgba(255,255,255,0.1); border-top-color: var(--accent); border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        #toast { position: fixed; bottom: 90px; left: 50%; transform: translateX(-50%) translateY(20px); background: #1a1a1a; border: 1px solid var(--accent); color: #fff; padding: 12px 25px; border-radius: 30px; display: flex; align-items: center; gap: 10px; opacity: 0; transition: 0.4s; pointer-events: none; z-index: 100; box-shadow: 0 5px 20px rgba(0,0,0,0.5); font-weight: 600; font-size: 0.9rem; }
        #toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }
    </style>
</head>
<body>
    <header>
        <div style="display:flex; align-items:center; gap:15px"><i class="fas fa-bars" style="color:var(--text-muted)"></i><div class="brand">DPMods</div></div>
        <div class="head-icons"><i class="fas fa-search"></i><i class="fas fa-moon"></i></div>
    </header>
    
    <div class="container">
        <div class="breadcrumb">Home <i class="fas fa-chevron-right" style="font-size:0.6rem"></i> KeyByDPMods</div>
        <h1>KeyByDPMods</h1>
        
        <div class="gen-card">
            <div class="lbl-title">GET YOUR KEY</div>
            <div class="lbl-status" id="statusMsg">System Status: Processing...</div>
            
            <div class="key-box" onclick="copyKey()">
                <div class="key-text" id="keyDisplay"><div class="loader"></div></div>
            </div>
            
            <button class="btn-action" onclick="copyKey()">Copy Key</button>

            <!-- SOCIAL MEDIA ICONS -->
            <div class="social-group">
                <a href="https://youtube.com/@dynamongamer07" target="_blank" class="soc-icon yt"><i class="fab fa-youtube"></i></a>
                <a href="https://t.me/dynamonsworld07" target="_blank" class="soc-icon tg"><i class="fab fa-telegram-plane"></i></a>
                <a href="https://whatsapp.com/channel/0029VbBdAcZ05MUmgk8cQP05" target="_blank" class="soc-icon wa"><i class="fab fa-whatsapp"></i></a>
            </div>

            <!-- ADMIN SUPPORT BUTTON -->
            <a href="http://t.me/ASTAMODS07" target="_blank" class="admin-btn">
                <i class="fas fa-headset" style="font-size:1.1rem; color:var(--accent)"></i> Admin Support
            </a>
        </div>

        <div class="footer"><span>Â© 2026. DPMods</span><span style="cursor:pointer" onclick="window.scrollTo(0,0)">Top <i class="fas fa-arrow-up"></i></span></div>
    </div>

    <div class="nav-bar">
        <div class="nav-btn"><i class="fas fa-home"></i>Home</div>
        <div class="nav-btn"><i class="fas fa-th-large"></i>Menu</div>
        <div class="nav-btn"><i class="fas fa-search"></i>Search</div>
        <div class="nav-btn active"><i class="far fa-id-card"></i>Key</div>
    </div>

    <div id="toast"><i class="fas fa-check-circle" style="color:var(--accent)"></i><span>Copied to Clipboard!</span></div>

    <script>
        const DB_URL = "https://gateway-260ec-default-rtdb.firebaseio.com/"; 
        const KEY_PREFIX = "DP-";
        
        const keyDisplay = document.getElementById('keyDisplay');
        const statusMsg = document.getElementById('statusMsg');

        window.onload = async function() {
            // 1. CLEANUP: Delete previous key if exists (One key per session)
            const oldKey = localStorage.getItem('dp_user_key');
            if(oldKey) {
                statusMsg.innerText = "System Status: Revoking old key...";
                await deleteOldKey(oldKey);
                localStorage.removeItem('dp_user_key');
            }

            // 2. GENERATE NEW KEY
            const rnd = Math.random().toString(36).substring(2, 7).toUpperCase();
            const newKey = KEY_PREFIX + rnd;

            // 3. CHECK FOR REFRESH
            // If page is merely refreshed (not fresh entry), do NOT save to DB
            const isRefresh = (window.performance && 
                               window.performance.getEntriesByType && 
                               window.performance.getEntriesByType("navigation").length > 0 && 
                               window.performance.getEntriesByType("navigation")[0].type === 'reload');

            if (isRefresh) {
                // Visual key only (Not in DB = Application treats as Data Error/Invalid)
                displayKey(newKey);
                statusMsg.innerText = "Error: Refresh Detected (Key Invalid)";
                statusMsg.style.color = "#ff3355";
            } else {
                // Valid Entry: Save to DB
                await uploadKey(newKey);
            }
        };

        async function deleteOldKey(key) {
            try {
                const cleanUrl = DB_URL.endsWith('/') ? DB_URL : DB_URL + '/';
                await fetch(`${cleanUrl}ValidKeys/${key}.json`, { method: 'DELETE' });
            } catch(e) { console.log("Cleanup error", e); }
        }

        async function uploadKey(key) {
            try {
                const cleanUrl = DB_URL.endsWith('/') ? DB_URL : DB_URL + '/';
                const target = `${cleanUrl}ValidKeys/${key}.json`;
                // Format: {"Hours": 24} -> Required for App
                const keyData = { "Hours": 24 };

                await fetch(target, {
                    method: 'PUT',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(keyData)
                });
                displayKey(key);
                statusMsg.innerText = "System Status: Key Active";
                statusMsg.style.color = "#8b949e";
                localStorage.setItem('dp_user_key', key);
            } catch(e) {
                console.error(e);
                statusMsg.innerText = "Error: Database Connection Failed";
                keyDisplay.innerHTML = `<span style="color:#ff3355; font-size:1rem;">CONNECT_ERR</span>`;
            }
        }

        function displayKey(k) { keyDisplay.innerText = k; }

        function copyKey() {
            const txt = keyDisplay.innerText;
            if(!txt || txt.includes("...") || txt === "CONNECT_ERR") return;
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(txt).then(triggerToast).catch(() => fallbackCopy(txt));
            } else { fallbackCopy(txt); }
        }

        function fallbackCopy(text) {
            const textArea = document.createElement("textarea");
            textArea.value = text;
            textArea.style.position = "fixed"; textArea.style.left = "-9999px";
            document.body.appendChild(textArea);
            textArea.focus(); textArea.select();
            try { document.execCommand('copy'); triggerToast(); } catch (err) { alert("Manual Copy Required: " + text); }
            document.body.removeChild(textArea);
        }

        function triggerToast() { const t = document.getElementById('toast'); t.classList.add('show'); setTimeout(() => t.classList.remove('show'), 2000); }
    </script>
</body>
</html>